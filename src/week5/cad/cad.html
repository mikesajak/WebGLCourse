<!DOCTYPE html>

<html>
<link>
    <link rel="stylesheet" type="text/css" href="cad.css">

    <script type="text/javascript" src="../../Common/webgl-utils.js"></script>
    <script type="text/javascript" src="../../Common/initShaders.js"></script>
    <script type="text/javascript" src="../../Common/MV.js"></script>
    <script type="text/javascript" src="cad.js"></script>

<script id="vertex-shader-simple" type="x-shader/x-vertex">

attribute vec4 vPosition;
//attribute vec4 vColor;
varying vec4 fColor;
uniform mat4 uModelViewMatrix;
uniform mat4 uProjectionMatrix;
uniform vec4 uColor;

void main()
{
    gl_Position = uProjectionMatrix * uModelViewMatrix * vPosition;
    fColor = uColor;
}
</script>

<script id="fragment-shader-simple" type="x-shader/x-fragment">

precision mediump float;

varying vec4 fColor;
void main()
{
    gl_FragColor = fColor;
}
</script>

<script id="vertex-shader-vertex-lighting" type="x-shader/x-vertex">

struct Material {
    vec3 ambient;
    vec3 diffuse;
    vec3 specular;
    float shininess;
};

struct Light {
    bool enabled;
    vec4 position;
    vec3 diffuse;
    vec3 specular;
};

varying vec4 fColor;
attribute vec4 vPosition;
attribute vec3 vNormal;

uniform mat4 uModelViewMatrix;
uniform mat4 uViewMatrix;
uniform mat3 uNormalMatrix;
uniform mat4 uProjectionMatrix;

uniform vec3 uGlobalAmbient;
uniform Material uMaterial;
uniform Light uLights[8];

vec3 calculateLighting(Light light) {
    // do lighting calculation in camera word space
    vec3 pos = (uModelViewMatrix * vPosition).xyz;
    vec3 lightPos = (uViewMatrix * light.position).xyz;

    vec3 L = normalize(lightPos - pos);
    vec3 E = normalize(-pos);
    vec3 H = normalize(L + E); // half vector

    // transform vertex normal into eye coordinates
    vec3 N = normalize(uNormalMatrix * vNormal.xyz);

    // compute terms in the illumination equation
    float Kd = max(dot(L, N), 0.0);
    vec3 diffuse = Kd * uMaterial.diffuse * light.diffuse;

    vec3 specular = vec3(0.0, 0.0, 0.0);

    if (dot(L, N) > 0.0) {
        float Ks = pow(max(dot(N, H), 0.0), uMaterial.shininess);
        specular = Ks * uMaterial.specular * light.specular;
    }

    // todo: distance attenuation

    vec3 color = diffuse + specular;

    return color;
}

void main()
{
    gl_Position = uProjectionMatrix * uModelViewMatrix * vPosition;

    // calculate color by material and lights
    vec3 color = uMaterial.ambient * uGlobalAmbient;
    for (int i = 0; i < 8; i++) {
        if (uLights[i].enabled) {
            color += calculateLighting(uLights[i]);
        }
    }

    fColor = vec4(color, 1.0);
}
</script>

    <script>
        window.onload = function init() {
            initGL();
        }

        function copyValue(inputId, outputId) {
            var inputElem = document.getElementById(inputId);
            var outputElem = document.getElementById(outputId);
            outputElem.value = inputElem.value;
            outputElem.oninput();
        }

        function setValue(outputId, value) {
            var outputElem = document.getElementById(outputId);
            outputElem.value = value;
            outputElem.oninput();
        }
    </script>
</head>

<body>
    <header>
        <h1>WebGL CAD</h1>
    </header>

    <section id="wrapper">

        <article id="leftcol">
            <table>
                <tr>
                    <td colspan="10"><fieldset class="featured-header cool"><legend>View options</legend></fieldset></td>
                </tr>
                <tr>
                    <td colspan="10">
                        <label for="showGridCheckbox">Show grid</label>
                        <input id="showGridCheckbox" type="checkbox" checked>
                        <label for="showWireframeCheckbox">Show wireframe</label>
                        <input id="showWireframeCheckbox" type="checkbox" checked>
                        <label for="drawNormalsCheckbox">Draw normals</label>
                        <input id="drawNormalsCheckbox" type="checkbox">
                    </td>

                </tr>

                <tr>
                    <td colspan="10"><fieldset class="featured-header cool"><legend>Camera</legend></fieldset></td>
                </tr>
                <tr>
                    <td>Position</td>
                    <td>
                        <label for="camXPosText">X:</label><input id="camXPosText" type="text" size="1" value="0"
                                                                  oninput="copyValue('camXPosText', 'camXPosSlider')">
                        <label for="camYPosText">Y:</label><input id="camYPosText" type="text" size="1" value="7"
                                                                  oninput="copyValue('camYPosText', 'camYPosSlider')">
                        <label for="camZPosText">Z:</label><input id="camZPosText" type="text" size="1" value="15"
                                                                  oninput="copyValue('camZPosText', 'camZPosSlider')">
                        <button id="camPosResetButton" onclick="setValue('camXPosText',0); setValue('camYPosText', 7); setValue('camZPosText', 15);">Reset</button>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="camXPosSlider">X</label>
                    </td>
                    <td>
                        <input id="camXPosSlider" type="range" min="-10" max="10" value="0" step="0.01"
                               oninput="copyValue('camXPosSlider', 'camXPosText')"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="camYPosSlider">Y</label>
                    </td>
                    <td>
                        <input id="camYPosSlider" type="range" min="-10" max="10" value="7" step="0.01"
                               oninput="copyValue('camYPosSlider', 'camYPosText')"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="camZPosSlider">Z</label>
                    </td>
                    <td>
                        <input id="camZPosSlider" type="range" min="-20" max="20" value="-15" step="0.01"
                               oninput="copyValue('camZPosSlider', 'camZPosText')"/>
                    </td>
                </tr>

                <tr>
                    <td colspan="10"><fieldset class="featured-header cool"><legend>Lighting</legend></fieldset></td>
                </tr>
                <tr>
                    <!--<td class="label"><label for="lightingModelChooser">Light model:</label></td>-->
                    <!--<td>-->
                        <!--<select id="lightingModelChooser">-->
                            <!--<option value="flat">Flat</option>-->
                            <!--<option value="lighting">Lighting</option>-->
                        <!--</select>-->
                    <!--</td>-->
                    <td colspan="10">
                        <label for="enableLightingCheckbox">Enable lighting</label>
                        <input id="enableLightingCheckbox" type="checkbox">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="globalAmbientColorChooser">Global ambient color:</label>
                    </td>
                    <td>
                        <input id="globalAmbientColorChooser" type="color" value="#FF1010"/>
                    </td>
                </tr>
                <tr>
                    <td colspan="10"><fieldset class="featured-header cool"><legend>Light 1</legend></fieldset></td>
                </tr>
                <tr>
                    <td>Position</td>
                    <td>
                        <label for="light0xPosText">X:</label><input id="light0xPosText" type="text" size="1" value="0"
                                                               oninput="copyValue('light0xPosText', 'light0xPosSlider')">
                        <label for="light0yPosText">Y:</label><input id="light0yPosText" type="text" size="1" value="0"
                                                               oninput="copyValue('light0yPosText', 'light0yPosSlider')">
                        <label for="light0zPosText">Z:</label><input id="light0zPosText" type="text" size="1" value="0"
                                                               oninput="copyValue('light0zPosText', 'light0zPosSlider')">
                        <button id="light0posResetButton" onclick="setValue('light0xPosText',0); setValue('light0yPosText', 0); setValue('light0zPosText', 0);">Reset</button>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="light0xPosSlider">X</label>
                    </td>
                    <td>
                        <input id="light0xPosSlider" type="range" min="-10" max="10" value="0" step="0.01"
                               oninput="copyValue('light0xPosSlider', 'light0xPosText')"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="light0yPosSlider">Y</label>
                    </td>
                    <td>
                        <input id="light0yPosSlider" type="range" min="-10" max="10" value="0" step="0.01"
                               oninput="copyValue('light0yPosSlider', 'light0yPosText')"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="light0zPosSlider">Z</label>
                    </td>
                    <td>
                        <input id="light0zPosSlider" type="range" min="-10" max="10" value="0" step="0.01"
                               oninput="copyValue('light0zPosSlider', 'light0zPosText')"/>
                    </td>
                </tr>


                <tr>
                    <td>TODO...</td>
                </tr>
            </table>
        </article>

        <article id="content">
            <canvas id="gl-canvas" width=512 height=512 style="border:1px solid #000000;">
                Oops... your browser doesn't support the HTML5 canvas element
            </canvas>
        </article>

        <article id="rightcol">
            <table>
                <tr>
                    <td colspan="10"><fieldset class="featured-header cool"><legend>Create model</legend></fieldset></td>
                </tr>
                <tr>
                    <td class="label"><label for="modelTypeChooser">Model:</label></td>
                    <td>
                        <select id="modelTypeChooser"></select>
                        <button id="createModelButton">Create</button>
                    </td>
                </tr>


                <tr>
                    <td colspan="10"><fieldset class="featured-header cool"><legend>Modify model</legend></fieldset></td>
                </tr>
                <tr>
                    <td class="label"><label for="selModelChooser">Selection:</label></td>
                    <td>
                        <select id="selModelChooser">
                            <option value=""/>
                        </select>
                        <!--<button id="deleteModelButton" disabled="true">Delete</button>-->
                    </td>
                </tr>

                <tr>
                    <td>Position</td>
                    <td>
                        <label for="xPosText">X:</label><input id="xPosText" type="text" size="1" value="0"
                                                               oninput="copyValue('xPosText', 'xPosSlider')">
                        <label for="yPosText">Y:</label><input id="yPosText" type="text" size="1" value="0"
                                                               oninput="copyValue('yPosText', 'yPosSlider')">
                        <label for="zPosText">Z:</label><input id="zPosText" type="text" size="1" value="0"
                                                               oninput="copyValue('zPosText', 'zPosSlider')">
                        <button id="posResetButton" onclick="setValue('xPosText',0); setValue('yPosText', 0); setValue('zPosText', 0);">Reset</button>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="xPosSlider">X</label>
                    </td>
                    <td>
                        <input id="xPosSlider" type="range" min="-10" max="10" value="0" step="0.01"
                               oninput="copyValue('xPosSlider', 'xPosText')"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="yPosSlider">Y</label>
                    </td>
                    <td>
                        <input id="yPosSlider" type="range" min="-10" max="10" value="0" step="0.01"
                               oninput="copyValue('yPosSlider', 'yPosText')"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="zPosSlider">Z</label>
                    </td>
                    <td>
                        <input id="zPosSlider" type="range" min="-10" max="10" value="0" step="0.01"
                               oninput="copyValue('zPosSlider', 'zPosText')"/>
                    </td>
                </tr>

                <tr>
                    <td>Rotation</td>
                    <td>
                        <label for="xRotText">X:</label><input id="xRotText" name="xRotText" type="text" size="1" value="0"
                                                               for="xRotSlider" oninput="xRotSlider.value=xRotText.value"/>
                                                               <!--oninput="copyValue('xRotText', 'xRotSlider')">-->
                        <label for="yRotText">Y:</label><input id="yRotText" name="yRotText" type="text" size="1" value="0"
                                                               for="yRotSlider" oninput="yRotSlider.value=yRotText.value"/>
                                                               <!--oninput="copyValue('yRotText', 'yRotSlider')">-->
                        <label for="zRotText">Z:</label><input id="zRotText" name="zRotText" type="text" size="1" value="0"
                                                               for="zRotSlider" oninput="zRotSlider.value=zRotText.value"/>
                                                               <!--oninput="copyValue('zRotText', 'zRotSlider')">-->
                        <button id="rotResetButton" onclick="setValue('xRotText',0); setValue('yRotText', 0); setValue('zRotText', 0);">Reset</button>
                        <!--<button id="rotResetButton" onclick="xRotText.value=0; xRotSlider.value=0; yRotText.value=0; yRotSlider.value=0; zRotText.value=0; zRotSlider.value=0;">Reset</button>-->
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="xRotSlider">X</label>
                    </td>
                    <td>
                        <input id="xRotSlider" name="xRotSlider" type="range" min="-180" max="180" value="0" step="1"
                                oninput="xRotText.value=xRotSlider.value"/>
                               <!--oninput="copyValue('xRotSlider', 'xRotText')"/>-->
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="yRotSlider">Y</label>
                    </td>
                    <td>
                        <input id="yRotSlider" name="yRotSlider" type="range" min="-180" max="180" value="0" step="1"
                               oninput="yRotText.value=yRotSlider.value"/>
                               <!--oninput="copyValue('yRotSlider', 'yRotText')"/>-->
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="zRotSlider">Z</label>
                    </td>
                    <td>
                        <input id="zRotSlider" name="zRotSlider" type="range" min="-180" max="180" value="0" step="1"
                               oninput="zRotText.value=zRotSlider.value"/>
                               <!--oninput="copyValue('zRotSlider', 'zRotText')"/>-->
                    </td>
                </tr>

                <tr>
                    <td>Scale</td>
                    <td>
                        <label for="xScaleText">X:</label><input id="xScaleText" type="text" size="1" value="1"
                                                               oninput="copyValue('xScaleText', 'xScaleSlider')">
                        <label for="yScaleText">Y:</label><input id="yScaleText" type="text" size="1" value="1"
                                                               oninput="copyValue('yScaleText', 'yScaleSlider')">
                        <label for="zScaleText">Z:</label><input id="zScaleText" type="text" size="1" value="1"
                                                               oninput="copyValue('zScaleText', 'zScaleSlider')">
                        <button id="scaleResetButton" onclick="setValue('xScaleText',1); setValue('yScaleText', 1); setValue('zScaleText', 1);">Reset</button>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="xScaleSlider">X</label>
                    </td>
                    <td>
                        <input id="xScaleSlider" type="range" min="0" max="10" value="1" step="0.01"
                               oninput="copyValue('xScaleSlider', 'xScaleText')"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="yScaleSlider">Y</label>
                    </td>
                    <td>
                        <input id="yScaleSlider" type="range" min="0" max="10" value="1" step="0.01"
                               oninput="copyValue('yScaleSlider', 'yScaleText')"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="zScaleSlider">Z</label>
                    </td>
                    <td>
                        <input id="zScaleSlider" type="range" min="0" max="10" value="1" step="0.01"
                               oninput="copyValue('zScaleSlider', 'zScaleText')"/>
                    </td>
                </tr>
                
            </table>
        </article>

    </section>

    <footer></footer>

</body>
</html>